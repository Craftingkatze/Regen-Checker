<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Regen Status - Deutschland</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }

html, body {
    width:100%;
    height:100%;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
}

body {
    transition: background-color .4s ease;
    display:flex;
    flex-direction:column;
    background:#6b7280;
    overflow-x:hidden;
}

body.green { background:linear-gradient(135deg, #22c55e 0%, #16a34a 100%); }
body.yellow { background:linear-gradient(135deg, #eab308 0%, #ca8a04 100%); }
body.red { background:linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
body.gray { background:linear-gradient(135deg, #6b7280 0%, #4b5563 100%); }

.container {
    width:100%;
    flex:1;
    display:flex;
    flex-direction:column;
    align-items:center;
    overflow-y:auto;
    padding:15px;
}

.card {
    background:rgba(255,255,255,.95);
    padding:20px;
    border-radius:18px;
    margin-bottom:20px;
    box-shadow:0 10px 30px rgba(0,0,0,.15);
    width:100%;
    max-width:500px;
}

h1 {
    margin-bottom:15px;
    font-size:26px;
    color:#1f2937;
    text-align:center;
}

.search-wrapper { position:relative; }

input {
    width:100%;
    padding:12px 16px;
    font-size:16px;
    border-radius:12px;
    border:2px solid #e5e7eb;
    outline:none;
    transition:all .3s;
    background:#f9fafb;
}

input:focus {
    border-color:#22c55e;
    background:white;
    box-shadow:0 4px 12px rgba(34,197,94,.1);
}

.suggestions {
    position:absolute;
    top:100%;
    left:0;
    right:0;
    background:white;
    border:2px solid #e5e7eb;
    border-top:none;
    border-radius:0 0 12px 12px;
    max-height:300px;
    overflow-y:auto;
    display:none;
    box-shadow:0 10px 25px rgba(0,0,0,.1);
    z-index:1000;
}

.suggestions div { padding:10px 15px; cursor:pointer; border-bottom:1px solid #f3f4f6; }
.suggestions div:hover { background:#f0fdf4; }
.suggestion-name { font-weight:600; color:#1f2937; }
.suggestion-detail { font-size:12px; color:#6b7280; }

.status-text { font-size:40px; font-weight:bold; text-align:center; margin-bottom:10px; text-shadow:2px 2px 8px rgba(0,0,0,.1);}
.location-info { font-size:20px; text-align:center; color:#4b5563; margin-bottom:5px; }
.weather-info { font-size:16px; text-align:center; color:#6b7280; margin-bottom:15px; }

.timeline-container {
    width:100%;
}

.day { margin-bottom:25px; }

.day-header {
    display:flex;
    justify-content:space-between;
    margin-bottom:10px;
}

.weekday { font-weight:700; color:#1f2937; }
.date { font-size:14px; color:#6b7280; }

.timeline {
    display:flex;
    width:100%;
    height:40px;
    position:relative;
    gap:2px;
}

.block {
    flex:1;
    display:flex;
    align-items:center;
    justify-content:center;
    border-radius:4px;
    font-size:10px;
    font-weight:600;
    color:white;
    transition:transform .2s;
}

.block.green { background:#22c55e; }
.block.yellow { background:#eab308; color:#1f2937; }
.block.red { background:#ef4444; }

.block:hover { transform:scaleY(1.15); cursor:pointer; }

.rainline {
    position:absolute;
    top:0;
    left:0;
    height:4px;
    background:rgba(0,0,0,.5);
    border-radius:2px;
}

button {
    margin-top:15px;
    padding:12px 24px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-size:16px;
    font-weight:600;
    background:#1f2937;
    color:white;
    width:100%;
    max-width:500px;
    transition:all .3s;
}

button:hover {
    background:#374151;
    transform:translateY(-2px);
}

.loading {
    color:white;
    text-align:center;
    margin-top:100px;
    font-size:28px;
    font-weight:600;
}

.legend {
    display:flex;
    gap:15px;
    margin-top:15px;
    flex-wrap:wrap;
}

.legend-item { display:flex; align-items:center; gap:5px; }
.legend-color { width:25px; height:15px; border-radius:3px; }
.legend-text { font-size:12px; color:#6b7280; }
</style>
</head>
<body class="gray">

<div class="container">
    <div class="card" id="startCard">
        <h1>üåßÔ∏è Regen Vorhersage Deutschland</h1>
        <div class="search-wrapper">
            <input id="locationInput" placeholder="Stadt oder Stadtteil eingeben...">
            <div class="suggestions" id="suggestions"></div>
        </div>
    </div>
</div>

<script>
const LOCATIONS = [
  {name:"Berlin", region:"Berlin", country:"Deutschland", lat:52.52, lon:13.405},
  {name:"Berlin-Mitte", region:"Berlin", country:"Deutschland", lat:52.5200, lon:13.4050},
  {name:"Hamburg", region:"Hamburg", country:"Deutschland", lat:53.5511, lon:9.9937},
  {name:"M√ºnchen", region:"Bayern", country:"Deutschland", lat:48.1351, lon:11.582}
];

const WEEKDAYS = ["So","Mo","Di","Mi","Do","Fr","Sa"];

const input = document.getElementById("locationInput");
const suggestions = document.getElementById("suggestions");

input.addEventListener("input", () => {
    const q = input.value.toLowerCase();
    suggestions.innerHTML = "";
    if(q.length < 2) return suggestions.style.display="none";
    const results = LOCATIONS.filter(l => l.name.toLowerCase().includes(q) || l.region.toLowerCase().includes(q)).slice(0,10);
    if(results.length === 0) return suggestions.style.display="none";
    results.forEach(loc=>{
        const div=document.createElement("div");
        div.innerHTML = `<div class="suggestion-name">${loc.name}</div><div class="suggestion-detail">${loc.region}, ${loc.country}</div>`;
        div.onclick=()=>selectLocation(loc);
        suggestions.appendChild(div);
    });
    suggestions.style.display="block";
});

document.addEventListener("click",(e)=>{
    if(!e.target.closest(".search-wrapper")) suggestions.style.display="none";
});

function selectLocation(location){
    suggestions.style.display="none";
    loadWeather(location);
}

function getStatus(precip,humidity,rainSoon){
    if(precip>0 || rainSoon) return {color:"red",text:"ACHTUNG"};
    if(humidity>85) return {color:"yellow",text:"FEUCHT"};
    return {color:"green",text:"TROCKEN"};
}

async function loadWeather(location){
    document.body.className="gray";
    document.body.innerHTML="<div class='loading'>Lade Wetter f√ºr "+location.name+"...</div>";
    try{
        const url=`https://api.open-meteo.com/v1/forecast?latitude=${location.lat}&longitude=${location.lon}&hourly=temperature_2m,relative_humidity_2m,precipitation&timezone=auto&forecast_days=7`;
        const res=await fetch(url);
        const data=await res.json();

        const now=new Date();
        const index=data.hourly.time.findIndex(t=>new Date(t)>=now);
        const precip=data.hourly.precipitation[index]||0;
        const humidity=data.hourly.relative_humidity_2m[index]||0;
        const temp=Math.round(data.hourly.temperature_2m[index]||0);
        const rainSoon=data.hourly.precipitation.slice(index,index+3).some(p=>p>0);
        const status=getStatus(precip,humidity,rainSoon);
        document.body.className=status.color;

        const container=document.createElement("div");
        container.className="container";
        container.innerHTML=`
        <div class="card">
            <div class="status-text">${status.text}</div>
            <div class="location-info">${location.name}</div>
            <div class="weather-info">${temp}¬∞C | Luftfeuchtigkeit: ${humidity}%</div>
            <button onclick="location.reload()">Andere Stadt</button>
            <div class="legend">
                <div class="legend-item"><div class="legend-color green"></div><span class="legend-text">Trocken</span></div>
                <div class="legend-item"><div class="legend-color yellow"></div><span class="legend-text">Feucht (>85%)</span></div>
                <div class="legend-item"><div class="legend-color red"></div><span class="legend-text">Regen</span></div>
            </div>
        </div>
        <div class="card">
            <h2 style="margin-bottom:10px;">7-Tage Vorhersage</h2>
            <div id="timeline" class="timeline-container"></div>
        </div>`;

        document.body.innerHTML="";
        document.body.appendChild(container);

        const days={};
        data.hourly.time.forEach((t,i)=>{
            const d=t.split("T")[0];
            if(!days[d]) days[d]={colors:[], times:[], rainIndexes:[]};
            const p=data.hourly.precipitation[i]||0;
            const h=data.hourly.relative_humidity_2m[i]||0;
            const soon=data.hourly.precipitation.slice(i,i+3).some(x=>x>0);
            const status=getStatus(p,h,soon);
            days[d].colors.push(status.color);
            days[d].times.push(t.split("T")[1].substring(0,5));
            if(status.color==="red") days[d].rainIndexes.push(i);
        });

        const timeline=document.getElementById("timeline");

        Object.keys(days).forEach(date=>{
            const dateObj=new Date(date+"T12:00:00");
            const weekday=WEEKDAYS[dateObj.getDay()];
            const div=document.createElement("div");
            div.className="day";
            div.innerHTML=`
                <div class="day-header">
                    <span class="weekday">${weekday}</span>
                    <span class="date">${date}</span>
                </div>
                <div class="timeline"></div>
            `;
            const row=div.querySelector(".timeline");

            const totalBlocks=days[date].colors.length;
            const maxWidth=row.offsetWidth || 400;
            const blockWidth=Math.max(maxWidth/totalBlocks,25);

            days[date].colors.forEach((color,idx)=>{
                const time=days[date].times[idx];
                const b=document.createElement("div");
                b.className="block "+color;
                b.style.minWidth=blockWidth+"px";
                b.textContent=time;
                row.appendChild(b);
            });

            // Regenlinie
            const rainline=document.createElement("div");
            rainline.className="rainline";
            if(days[date].rainIndexes.length>0){
                const start=(days[date].rainIndexes[0]/totalBlocks)*100;
                const end=(days[date].rainIndexes[days[date].rainIndexes.length-1]/totalBlocks)*100;
                rainline.style.left=start+"%";
                rainline.style.width=(end-start)+"%";
                row.appendChild(rainline);
            }

            timeline.appendChild(div);
        });

    }catch(e){
        document.body.innerHTML="<div class='loading'>‚ùå Fehler beim Laden der Wetterdaten</div>";
        console.error(e);
    }
}
</script>
</body>
</html>
